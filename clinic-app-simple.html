<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClinicShield - Enterprise Cyber Recovery Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: 
                radial-gradient(circle at 20% 50%, rgba(16, 185, 129, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(52, 211, 153, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(110, 231, 183, 0.05) 0%, transparent 50%),
                linear-gradient(135deg, #ecfdf5 0%, #9ebdf7 30%, #9ebdf7 70%, #f0fdf4 100%);
            background-attachment: fixed;
            color: #1f2937;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 8px,
                    rgba(16, 185, 129, 0.15) 8px,
                    rgba(16, 185, 129, 0.15) 11px
                ),
                repeating-linear-gradient(
                    -45deg,
                    transparent,
                    transparent 8px,
                    rgba(52, 211, 153, 0.12) 8px,
                    rgba(52, 211, 153, 0.12) 11px
                );
            pointer-events: none;
            z-index: -1;
        }
        
        /* Clean Header like Custo */
        .amazon-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            color: #1f2937;
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            position: relative;
            z-index: 2;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .nav-links a {
            color: #6b7280;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
            padding: 8px 16px;
            border-radius: 6px;
        }
        
        .nav-links a:hover {
            color: #1f2937;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .cta-buttons {
            display: flex;
            gap: 15px;
        }
        
        .btn-trial {
            background: #1f2937;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-trial:hover {
            background: #374151;
        }
        
        .btn-demo {
            background: white;
            color: #1f2937;
            padding: 12px 24px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-demo:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        
        /* Clean Hero Section like Custo */
        .hero-section {
            background: transparent;
            color: #1f2937;
            padding: 100px 0;
            text-align: center;
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }
        
        .intro-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            color: #6b7280;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .hero-title {
            font-size: 56px;
            font-weight: 800;
            margin-bottom: 24px;
            line-height: 1.1;
            color: #1f2937;
        }
        
        .hero-subtitle {
            font-size: 24px;
            margin-bottom: 16px;
            color: #4b5563;
        }
        
        .hero-description {
            font-size: 20px;
            margin-bottom: 40px;
            color: #6b7280;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .hero-features {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .hero-feature {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 500;
        }
        
        .hero-cta {
            margin-top: 40px;
        }
        
        .btn-hero {
            background: #1f2937;
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-hero:hover {
            background: #374151;
        }
        
        /* Vision Section with Same Background */
        .vision-section {
            background: 
                radial-gradient(circle at 20% 50%, rgba(16, 185, 129, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(52, 211, 153, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(110, 231, 183, 0.05) 0%, transparent 50%),
                linear-gradient(135deg, #ecfdf5 0%, #9ebdf7 30%, #9ebdf7 70%, #f0fdf4 100%);
            padding: 80px 0;
            position: relative;
        }
        
        .vision-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 8px,
                    rgba(16, 185, 129, 0.15) 8px,
                    rgba(16, 185, 129, 0.15) 11px
                ),
                repeating-linear-gradient(
                    -45deg,
                    transparent,
                    transparent 8px,
                    rgba(52, 211, 153, 0.12) 8px,
                    rgba(52, 211, 153, 0.12) 11px
                );
            pointer-events: none;
            z-index: 0;
        }
        
        .vision-section .container {
            position: relative;
            z-index: 1;
        }
        
        /* Modern Container Styling */
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 40px 20px; 
        }
        
        .card { 
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 4px 24px rgba(0,0,0,0.06);
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0,0,0,0.15);
        }
        
        .card h2 {
            color: #131a22;
            font-size: 32px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Enhanced Tab Styling */
        .tab-buttons { 
            display: flex; 
            gap: 4px; 
            margin-bottom: 32px; 
            background: #f1f3f6;
            padding: 6px;
            border-radius: 12px;
        }
        
        .tab-btn { 
            padding: 14px 24px; 
            border: none; 
            background: transparent; 
            cursor: pointer; 
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            color: #565959;
            transition: all 0.2s;
            flex: 1;
            text-align: center;
        }
        
        .tab-btn.active { 
            background: white; 
            color: #131a22;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .tab-btn:hover:not(.active) {
            background: rgba(255,255,255,0.7);
        }
        
        /* Tab Content Visibility */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Premium Clinic Cards */
        .clinic-options { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 24px; 
            margin: 32px 0;
        }
        
        .clinic-card { 
            border: 2px solid #e1e5e9; 
            padding: 32px; 
            border-radius: 16px; 
            cursor: pointer; 
            transition: all 0.3s;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        .clinic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #9ebdf7, #7bb3f5);
            transform: scaleX(0);
            transition: transform 0.3s;
        }
        
        .clinic-card:hover { 
            border-color: #9ebdf7; 
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(158, 189, 247, 0.15);
        }
        
        .clinic-card:hover::before {
            transform: scaleX(1);
        }
        
        .clinic-card.selected { 
            border-color: #9ebdf7; 
            background: rgba(158, 189, 247, 0.05);
            box-shadow: 0 4px 16px rgba(158, 189, 247, 0.15);
        }
        
        .clinic-card.selected::before {
            transform: scaleX(1);
        }
        
        .clinic-card h4 {
            font-size: 20px;
            margin-bottom: 12px;
            color: #131a22;
        }
        
        .clinic-card p {
            color: #565959;
            margin-bottom: 8px;
        }
        
        /* Enhanced Metrics */
        .metrics { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 24px;
        }
        
        .metric { 
            text-align: center; 
            padding: 32px 24px; 
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.2s;
        }
        
        .metric:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        
        .metric-value { 
            font-size: 2.5rem; 
            font-weight: 800; 
            color: #131a22;
            margin-bottom: 8px;
        }
        
        .metric-label { 
            font-size: 0.95rem; 
            color: #565959; 
            font-weight: 500;
        }
        
        /* Slider styling */
        .param-group {
            margin-bottom: 20px;
        }
        
        .param-group label {
            font-size: 0.95rem;
            color: #565959;
            font-weight: 500;
            display: block;
            margin-bottom: 8px;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            border: none;
        }
        
        /* Enhanced Forms */
        .input-group { 
            margin-bottom: 24px; 
        }
        
        .input-group label { 
            display: block; 
            margin-bottom: 12px; 
            font-weight: 600;
            color: #131a22;
            font-size: 16px;
        }
        
        .input-group select { 
            width: 100%; 
            padding: 16px 20px; 
            border: 2px solid #e1e5e9; 
            border-radius: 12px;
            font-size: 16px;
            background: white;
            transition: all 0.2s;
        }
        
        .input-group select:focus {
            border-color: #9ebdf7;
            outline: none;
            box-shadow: 0 0 0 2px rgba(158, 189, 247, 0.2);
        }
        
        /* Premium Buttons */
        .btn-primary { 
            background: #9ebdf7;
            color: white; 
            padding: 18px 36px; 
            border: none; 
            border-radius: 8px; 
            font-size: 16px;
            cursor: pointer; 
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-primary:hover { 
            background: #7bb3f5;
        }
        
        /* Enhanced Alerts */
        .alert { 
            padding: 24px; 
            background: linear-gradient(135deg, #e8f5e8 0%, #d4f4dd 100%);
            border: 1px solid #b8e6c1; 
            border-radius: 12px;
            margin: 24px 0;
            border-left: 4px solid #28a745;
        }
        
        /* Floating AI Chatbot Styles */
        .chatbot-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .chatbot-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9ebdf7 0%, #7bb3f5 100%);
            border: none;
            box-shadow: 0 4px 20px rgba(158, 189, 247, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }
        
        .chatbot-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(158, 189, 247, 0.4);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 4px 20px rgba(158, 189, 247, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(158, 189, 247, 0.6); }
            100% { box-shadow: 0 4px 20px rgba(158, 189, 247, 0.3); }
        }
        
        .chatbot-window {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 350px;
            height: 450px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(158, 189, 247, 0.2);
        }
        
        .chatbot-window.active {
            display: flex;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .chatbot-header {
            background: linear-gradient(135deg, #9ebdf7 0%, #7bb3f5 100%);
            color: white;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chatbot-title {
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }
        
        .chatbot-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }
        
        .message.bot {
            background: #f3f4f6;
            color: #1f2937;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        
        .message.user {
            background: linear-gradient(135deg, #9ebdf7 0%, #7bb3f5 100%);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        
        .chatbot-input-container {
            padding: 16px 20px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .chatbot-input {
            flex: 1;
            border: 1px solid #d1d5db;
            border-radius: 20px;
            padding: 10px 16px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .chatbot-input:focus {
            border-color: #9ebdf7;
        }
        
        .chatbot-send {
            background: linear-gradient(135deg, #9ebdf7 0%, #7bb3f5 100%);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: transform 0.2s;
        }
        
        .chatbot-send:hover {
            transform: scale(1.05);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 12px 16px;
            background: #f3f4f6;
            border-radius: 16px;
            border-bottom-left-radius: 4px;
            max-width: 80%;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #9ca3af;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-10px); opacity: 1; }
        }

        /* Chart Enhancements */
        .chart-container { 
            height: 400px; 
            margin: 40px 0;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }
        
        /* Typography */
        h1 { 
            font-size: 2.5rem; 
            margin-bottom: 20px; 
            color: #131a22;
            font-weight: 700;
        }
        
        h2 { 
            font-size: 2rem; 
            margin-bottom: 20px; 
            color: #131a22;
            font-weight: 600;
        }
        
        h3 { 
            font-size: 1.5rem; 
            margin-bottom: 16px; 
            color: #131a22;
            font-weight: 600;
        }
        
        p { 
            line-height: 1.6; 
            margin-bottom: 12px; 
            color: #565959;
        }
        
        /* Additional Styling */
        .testimonial-card {
            background: white;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }
        
        .testimonial-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0,0,0,0.12);
        }
        
        .pricing-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0,0,0,0.15);
        }
        
        /* Chart Analysis Section */
        .chart-analysis-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 40px;
            align-items: start;
        }

        /* Reset any default margins that might cause stagger */
        .chart-analysis-section > * {
            margin: 0;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            height: 400px;
            display: flex;
            flex-direction: column;
            margin: 0;
        }

        /* AI Message Box */
        .ai-message-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            border: 1px solid #dee2e6;
            height: 400px;
            display: flex;
            flex-direction: column;
            margin: 0;
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            font-weight: 600;
            color: #495057;
        }

        .ai-icon {
            font-size: 20px;
        }

        .ai-title {
            font-size: 16px;
        }

        .ai-content {
            margin-bottom: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .ai-message {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #9ebdf7;
            font-size: 14px;
            line-height: 1.5;
            color: #495057;
            flex: 1;
            display: flex;
            align-items: center;
        }

        /* Ensure canvas fills chart container */
        #before-after-chart {
            width: 100% !important;
            height: 100% !important;
        }

        .loading-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #9ebdf7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-ai-analyze {
            background: linear-gradient(135deg, #9ebdf7 0%, #7bb3f5 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .btn-ai-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(158, 189, 247, 0.3);
        }

        .btn-ai-analyze:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-title { font-size: 36px; }
            .hero-subtitle { font-size: 20px; }
            .hero-features { flex-direction: column; gap: 20px; }
            .clinic-options { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; gap: 20px; }
            .nav-links { gap: 20px; }
            .chart-analysis-section { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Amazon-style Header -->
    <header class="amazon-header">
        <div class="header-content">
            <div class="logo">
                üõ°Ô∏è ClinicShield
            </div>
            <nav class="nav-links">
                <a href="#recovery-planning" onclick="scrollToSection('recovery-planning')">Recovery Planning</a>
                <a href="#financial-assessment" onclick="scrollToSection('financial-assessment')">Financial Assessment</a>
                <a href="#our-vision" onclick="scrollToSection('our-vision')">Our Vision</a>
            </nav>
            <div class="cta-buttons">
                <button class="btn-demo">Watch Demo</button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <div class="intro-badge">
                Introducing ClinicShield ‚Üí
            </div>
            <h1 class="hero-title">AI-Powered Cyber Recovery for Clinics</h1>
            <p class="hero-subtitle">Protect Your Practice. Predict Your Recovery.</p>
            <p class="hero-description">
                The first machine learning platform that predicts cyber attack recovery times for small medical practices. 
                Get personalized recovery plans powered by analysis of 150+ real clinic incidents.
            </p>
            
            <div class="hero-features">
                <div class="hero-feature">
                    <span>ü§ñ</span> AI-Powered Predictions
                </div>
                <div class="hero-feature">
                    <span>‚ö°</span> Real-Time Analysis
                </div>
                <div class="hero-feature">
                    <span>üìä</span> 150+ Training Cases
                </div>
                <div class="hero-feature">
                    <span>üéØ</span> ¬±1.2 Week Accuracy
                </div>
            </div>
            
            <div class="hero-cta">
                <button class="btn-hero" onclick="scrollToDemo()">Try Live Demo Below ‚Üì</button>
            </div>
        </div>
    </section>

    <main>
        <div class="container" id="demo">
            
            <!-- Recovery Planning -->
            <div class="card" id="recovery-planning">
                <h2>üéØ AI Recovery Planning</h2>
                
                <h3>Select Your Clinic</h3>
                <div class="clinic-options">
                    <div class="clinic-card" onclick="selectClinic('small')">
                        <h4>Solo Family Practice</h4>
                        <p>1 doctor, $320K revenue</p>
                        <p><strong>Operating Days: 48</strong></p>
                    </div>
                    <div class="clinic-card" onclick="selectClinic('medium')">
                        <h4>Metro Medical Group</h4>
                        <p>2-3 doctors, $780K revenue</p>
                        <p><strong>Operating Days: 55</strong></p>
                    </div>
                </div>
                
                <h3>Select Attack Scenario</h3>
                <div class="input-group">
                    <label>Attack Type</label>
                    <select id="attack-type" onchange="currentAttackType = this.value; console.log('Attack type changed to:', currentAttackType);">
                        <option value="phishing">üìß Phishing Attack - Social engineering via email</option>
                        <option value="ransomware" selected>üîí Ransomware - Systems encrypted for ransom</option>
                        <option value="data_breach">üíî Data Breach - Patient records compromised</option>
                    </select>
                </div>
                
                <button class="btn-primary" onclick="generateRecovery()">ü§ñ Generate AI Recovery Plan</button>
                
                <div id="recovery-results" style="margin-top: 32px; display: none;">
                    <div id="results-content">
                        <p>Click "Generate AI Recovery Plan" to see your personalized recovery strategy.</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="recovery-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Financial Overview -->
            <div class="card" id="financial-assessment">
                <h2>üìä Financial Impact Projection</h2>
                
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="showTab('before')">üìä Current State</button>
                    <button class="tab-btn" onclick="showTab('after')">üí• After Attack</button>
                </div>

                <!-- Attack Parameters -->
                <h3>Ransomware Parameters</h3>
                <div class="param-group">
                    <label for="downtime-days">Downtime Days: <span id="downtime-value">7</span></label>
                    <input type="range" id="downtime-days" value="7" min="1" max="30" step="1" class="slider">
                </div>
                <div class="param-group">
                    <label for="ransom-amount">Ransom Amount: $<span id="ransom-value">25,000</span></label>
                    <input type="range" id="ransom-amount" value="25000" min="0" max="100000" step="1000" class="slider">
                </div>
                <div class="param-group">
                    <label for="recapture-rate">Recapture Rate: <span id="recapture-value">60</span>%</label>
                    <input type="range" id="recapture-rate" value="60" min="0" max="100" step="5" class="slider">
                </div>
            </div>
                
                <div id="tab-before" class="tab-content active">
                    <div class="metrics" id="before-metrics">
                        <div class="metric">
                            <div class="metric-value">$27K</div>
                            <div class="metric-label">Monthly Revenue</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">$26K</div>
                            <div class="metric-label">Monthly Expenses</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">$42K</div>
                            <div class="metric-label">Cash Reserves</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">48 days</div>
                            <div class="metric-label">Operating Runway</div>
                        </div>
                    </div>
                    
                    <!-- Monte Carlo Simulation Chart and AI Analysis -->
                    <div class="chart-analysis-section">
                        <div class="chart-container" style="position: relative;">
                            <canvas id="monte-carlo-chart"></canvas>
                            <div class="simulation-params" style="position: absolute; top: 10px; right: 10px; font-size: 10px; color: #999; text-align: right; line-height: 1.3; background: rgba(255, 255, 255, 0.9); padding: 8px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <div><strong>Parameters:</strong></div>
                                <div>Downtime: 3-30 days</div>
                                <div>Ransom: $0-$300k</div>
                                <div>Payment: 80% rate</div>
                                <div>Recapture: 0-80%</div>
                            </div>
                        </div>
                        <div class="ai-message-box">
                            <div class="ai-header">
                                <span class="ai-icon">ü§ñ</span>
                                <span class="ai-title">AI Assistant Says...</span>
                            </div>
                            <div class="ai-content">
                                <div id="ai-loading-before" class="loading-indicator" style="display: none;">
                                    <div class="loading-spinner"></div>
                                    <span>AI is analyzing your data...</span>
                                </div>
                                <div id="ai-message-before" class="ai-message">
                                    Click "Generate Analysis" to get AI insights about your clinic's financial resilience.
                                </div>
                            </div>
                            <button id="generate-analysis-before" class="btn-ai-analyze" onclick="generateMonteCarloAnalysis()">
                                Generate AI Analysis
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="tab-after" class="tab-content">
                    <div class="metrics" id="after-metrics">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    
                    <!-- Financial Impact Chart and AI Analysis -->
                    <div class="chart-analysis-section">
                        <div class="chart-container">
                            <canvas id="before-after-chart"></canvas>
                        </div>
                        <div class="ai-message-box">
                            <div class="ai-header">
                                <span class="ai-icon">ü§ñ</span>
                                <span class="ai-title">AI Assistant Says...</span>
                            </div>
                            <div class="ai-content">
                                <div id="ai-loading" class="loading-indicator" style="display: none;">
                                    <div class="loading-spinner"></div>
                                    <span>AI is analyzing your data...</span>
                                </div>
                                <div id="ai-message" class="ai-message">
                                    Click "Generate Analysis" to get AI insights about your clinic's financial impact.
                                </div>
                            </div>
                            <button class="btn-ai-analyze" onclick="generateHistogramAndAnalysis()">
                                Generate AI Analysis
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Our Vision Section -->
    <div class="container">
        <div style="text-align: center; margin-bottom: 60px;">
            <h2 style="font-size: 36px; color: #1f2937; margin-bottom: 24px;">üéØ Our Vision</h2>
            <p style="font-size: 20px; color: #1f2937; max-width: 800px; margin: 0 auto; line-height: 1.6; font-weight: 500;">
                Small healthcare practices are increasingly vulnerable to cyber attacks, yet they lack the resources and expertise to adequately prepare for and recover from these incidents. We believe that every clinic, regardless of size, deserves access to enterprise-level AI-powered cyber resilience tools that can predict recovery timelines and provide actionable financial planning to keep their doors open during the most challenging times.
            </p>
        </div>
        
        <div style="text-align: center; margin-top: 40px; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.12);">
            <h3 style="color: #1f2937; margin-bottom: 24px; font-size: 24px;">üöÄ Transform Your Practice</h3>
            <button class="btn-primary" onclick="scrollToDemo()" style="font-size: 18px; padding: 16px 32px;">
                Try AI Platform
            </button>
        </div>
    </div>
    

    <!-- Footer -->
    <footer style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-top: 1px solid rgba(0, 0, 0, 0.1); color: #1f2937; padding: 60px 0 30px;">
        <div class="container">
            <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; gap: 8px; color: #1f2937;">
                    üõ°Ô∏è ClinicShield
                </div>
                <p style="color: #6b7280; line-height: 1.6; max-width: 600px; margin: 0 auto;">
                    The first AI-powered cyber recovery platform built specifically for healthcare practices. 
                    Protect your clinic with machine learning intelligence.
                </p>
            </div>
        </div>
    </footer>

    <!-- Floating AI Chatbot -->
    <div class="chatbot-container">
        <button class="chatbot-button" id="chatbotButton">
            ü§ñ
        </button>
        
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <div class="chatbot-title">
                    ü§ñ ClinicShield AI Assistant
                </div>
                <button class="chatbot-close" id="chatbotClose">
                    √ó
                </button>
            </div>
            
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="message bot">
                    Hi! I'm your ClinicShield AI assistant. I can help you with questions about cyber recovery planning, our AI predictions, pricing, or anything else about protecting your clinic. How can I assist you today? üõ°Ô∏è
                </div>
            </div>
            
            <div class="chatbot-input-container">
                <input type="text" class="chatbot-input" id="chatbotInput" placeholder="Ask me anything about ClinicShield..." maxlength="500">
                <button class="chatbot-send" id="chatbotSend">
                    ‚û§
                </button>
            </div>
        </div>
    </div>

    <script>
        // Floating Chatbot Functionality
        class ClinicShieldChatbot {
            constructor() {
                this.isOpen = false;
                this.messages = [];
                this.init();
            }
            
            init() {
                this.button = document.getElementById('chatbotButton');
                this.window = document.getElementById('chatbotWindow');
                this.closeBtn = document.getElementById('chatbotClose');
                this.messagesContainer = document.getElementById('chatbotMessages');
                this.input = document.getElementById('chatbotInput');
                this.sendBtn = document.getElementById('chatbotSend');
                
                this.button.addEventListener('click', () => this.toggleChat());
                this.closeBtn.addEventListener('click', () => this.closeChat());
                this.sendBtn.addEventListener('click', () => this.sendMessage());
                this.input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });
                
                // Smooth floating movement on scroll
                this.setupFloatingMovement();
            }
            
            setupFloatingMovement() {
                let ticking = false;
                const chatbotContainer = document.querySelector('.chatbot-container');
                
                const updatePosition = () => {
                    const scrollY = window.scrollY;
                    const maxMove = 20;
                    const moveAmount = Math.sin(scrollY * 0.01) * maxMove;
                    
                    chatbotContainer.style.transform = `translateY(${moveAmount}px)`;
                    ticking = false;
                };
                
                window.addEventListener('scroll', () => {
                    if (!ticking) {
                        requestAnimationFrame(updatePosition);
                        ticking = true;
                    }
                });
            }
            
            toggleChat() {
                if (this.isOpen) {
                    this.closeChat();
                } else {
                    this.openChat();
                }
            }
            
            openChat() {
                this.isOpen = true;
                this.window.classList.add('active');
                this.input.focus();
            }
            
            closeChat() {
                this.isOpen = false;
                this.window.classList.remove('active');
            }
            
            async sendMessage() {
                const message = this.input.value.trim();
                if (!message) return;
                
                // Add user message
                this.addMessage(message, 'user');
                this.input.value = '';
                
                // Show typing indicator
                this.showTyping();
                
                // Simulate AI response delay
                setTimeout(() => {
                    this.hideTyping();
                    const response = this.generateResponse(message);
                    this.addMessage(response, 'bot');
                }, 1000 + Math.random() * 1500);
            }
            
            addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.textContent = text;
                
                this.messagesContainer.appendChild(messageDiv);
                this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
            }
            
            showTyping() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.id = 'typingIndicator';
                typingDiv.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
                
                this.messagesContainer.appendChild(typingDiv);
                this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
            }
            
            hideTyping() {
                const typing = document.getElementById('typingIndicator');
                if (typing) typing.remove();
            }
            
            generateResponse(userMessage) {
                const message = userMessage.toLowerCase();
                
                // Comprehensive knowledge base
                const responses = {
                    greeting: [
                        "Hello! I'm here to help you understand how ClinicShield can protect your practice from cyber threats. What would you like to know?",
                        "Hi there! Welcome to ClinicShield. I can answer questions about our AI-powered cyber recovery platform. How can I assist you?",
                        "Hey! Great to see you're interested in ClinicShield. I'm here to help with any questions about our cyber resilience solutions."
                    ],
                    
                    about: [
                        "ClinicShield is the first AI-powered cyber recovery platform built specifically for healthcare practices. We use machine learning trained on 150+ real clinic incidents to predict recovery times with ¬±1.2 week accuracy and provide personalized financial planning.",
                        "We're revolutionizing healthcare cybersecurity! ClinicShield combines real AI predictions with financial planning to help clinics prepare for and recover from cyber attacks. Our ML model analyzes attack types, clinic characteristics, and historical data to create custom recovery plans."
                    ],
                    
                    ai: [
                        "Our AI model was trained on 150+ real clinic cyber incidents, analyzing factors like attack type, clinic size, revenue, and IT infrastructure. It predicts recovery times with ¬±1.2 week accuracy and automatically calculates financial impact including lost revenue, recovery costs, and insurance considerations.",
                        "The AI uses advanced machine learning to process attack scenarios (ransomware, phishing, data breaches) and clinic data (size, revenue, location) to generate personalized recovery timelines and financial projections. It's like having a cyber security expert and financial advisor in one platform!"
                    ],
                    
                    pricing: [
                        "ClinicShield offers flexible pricing for clinics of all sizes. Our basic plan starts at $99/month for solo practices, with enterprise solutions for larger medical groups. We also offer free consultations and demos. Would you like to schedule a demo?",
                        "We believe every clinic deserves enterprise-level protection! Pricing starts at $99/month for small practices and scales based on your clinic size and needs. All plans include AI predictions, financial planning, and 24/7 support. Contact us for a custom quote!"
                    ],
                    
                    security: [
                        "Security is our top priority! ClinicShield is HIPAA compliant, uses end-to-end encryption, and follows SOC 2 Type II standards. Your clinic data never leaves our secure, healthcare-grade infrastructure. We're also backed by healthcare cybersecurity insurance.",
                        "Absolutely! We understand healthcare data sensitivity. ClinicShield meets all HIPAA requirements, uses military-grade encryption, and is audited regularly. Your patient data and business information are completely secure and private."
                    ],
                    
                    demo: [
                        "Great! You can try our live demo right on this page - just scroll up to the 'AI Recovery Planning' section. Select your clinic type and attack scenario to see our AI in action. For a personalized demo, I can connect you with our team!",
                        "Perfect! The interactive demo above shows our AI predictions in real-time. Try selecting different clinic types and attack scenarios to see how our ML model works. For a full platform demo with your clinic's specific data, we'd love to schedule a call!"
                    ],
                    
                    attacks: [
                        "ClinicShield protects against the most common healthcare cyber threats: ransomware attacks (encrypting your systems), phishing attacks (email-based social engineering), and data breaches (patient record compromises). Our AI predicts recovery time and costs for each scenario.",
                        "We cover all major cyber threats to clinics: üîí Ransomware (avg 2-4 week recovery), üìß Phishing (avg 1-2 week recovery), and üíî Data breaches (avg 3-6 week recovery). Our AI considers your specific clinic setup to provide accurate predictions."
                    ],
                    
                    support: [
                        "ClinicShield provides 24/7 support through multiple channels: live chat, phone support, and emergency incident response. During an actual cyber attack, you get priority access to our cyber recovery specialists who guide you through every step.",
                        "We're here whenever you need us! Our support includes: 24/7 emergency response, dedicated account managers for larger practices, comprehensive training materials, and a direct hotline during active incidents. You're never alone with ClinicShield."
                    ],
                    
                    insurance: [
                        "Yes! ClinicShield integrates with cyber insurance policies and can help you understand coverage gaps. Our financial projections include insurance considerations, and we work with major healthcare insurers. We can also help you find better cyber insurance rates.",
                        "Absolutely! We work closely with cyber insurance providers and can help you navigate claims during an incident. Our AI predictions are accepted by most insurers, and having ClinicShield often qualifies you for better insurance rates and coverage."
                    ]
                };
                
                // Smart response matching
                if (message.includes('hello') || message.includes('hi') || message.includes('hey')) {
                    return this.getRandomResponse(responses.greeting);
                } else if (message.includes('what') && (message.includes('clinicshield') || message.includes('about'))) {
                    return this.getRandomResponse(responses.about);
                } else if (message.includes('ai') || message.includes('artificial intelligence') || message.includes('machine learning') || message.includes('ml')) {
                    return this.getRandomResponse(responses.ai);
                } else if (message.includes('price') || message.includes('cost') || message.includes('pricing') || message.includes('expensive')) {
                    return this.getRandomResponse(responses.pricing);
                } else if (message.includes('secure') || message.includes('security') || message.includes('hipaa') || message.includes('privacy')) {
                    return this.getRandomResponse(responses.security);
                } else if (message.includes('demo') || message.includes('try') || message.includes('test')) {
                    return this.getRandomResponse(responses.demo);
                } else if (message.includes('attack') || message.includes('ransomware') || message.includes('phishing') || message.includes('breach')) {
                    return this.getRandomResponse(responses.attacks);
                } else if (message.includes('support') || message.includes('help') || message.includes('emergency')) {
                    return this.getRandomResponse(responses.support);
                } else if (message.includes('insurance') || message.includes('coverage') || message.includes('claim')) {
                    return this.getRandomResponse(responses.insurance);
                } else {
                    // General helpful responses
                    const generalResponses = [
                        "That's a great question! ClinicShield specializes in AI-powered cyber recovery for healthcare practices. Could you be more specific about what aspect you'd like to know about - our AI predictions, pricing, security, or something else?",
                        "I'd love to help you with that! ClinicShield offers comprehensive cyber protection for clinics. Are you interested in learning about our AI technology, seeing a demo, or discussing how we can protect your specific practice?",
                        "Thanks for your interest in ClinicShield! I can help you understand our AI predictions, cyber recovery planning, pricing, security features, or anything else. What's most important to you right now?",
                        "Great question! ClinicShield is designed to make cyber recovery simple and predictable for healthcare practices. Would you like to know more about our AI technology, see how it works, or discuss your clinic's specific needs?"
                    ];
                    return this.getRandomResponse(generalResponses);
                }
            }
            
            getRandomResponse(responses) {
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }
        
        // Initialize chatbot when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ClinicShieldChatbot();
        });

        // Global variables
        let currentClinic = null;
        let currentAttackType = 'ransomware'; // Default selection
        let recoveryChart = null;
        let trainedModel = null;
        
        // Clinic data
        const clinicData = {
            small: {
                name: 'Solo Family Practice',
                monthlyRevenue: 26650,
                monthlyExpenses: 26250,
                liquidAssets: 42000,
                operatingDays: 48,
                dailyCosts: 875,
                annualRevenue: 320000,
                dailyOperatingCosts: 875,
                monthlyProfit: 8750,
                patientVisitsPerDay: 18,
                avgVisitRevenue: 95,
            },
            medium: {
                name: 'Metro Medical Group',
                monthlyRevenue: 65000,
                monthlyExpenses: 64500,
                liquidAssets: 118000,
                operatingDays: 55,
                dailyCosts: 2150
            }
        };
        
        // AI Financial Impact Calculator
        function calculateAIFinancialImpact(clinic, attackType) {
            const baseImpactRatios = {
                'phishing': {
                    directLoss: 0.05,  // 5% of monthly revenue
                    downtimeLoss: 0.08, // 8% revenue loss during recovery
                    recoveryCost: 0.03, // 3% for recovery costs
                    description: 'Email compromise + credential theft'
                },
                'ransomware': {
                    directLoss: 0.25,  // 25% of monthly revenue 
                    downtimeLoss: 0.40, // 40% revenue loss during extended downtime
                    recoveryCost: 0.15, // 15% for ransom + recovery
                    description: 'System encryption + ransom demand + recovery'
                },
                'data_breach': {
                    directLoss: 0.15,  // 15% of monthly revenue
                    downtimeLoss: 0.20, // 20% revenue loss
                    recoveryCost: 0.12, // 12% for compliance + notifications
                    description: 'Patient data compromised + compliance costs'
                }
            };
            
            const impact = baseImpactRatios[attackType] || baseImpactRatios['phishing'];
            
            // Calculate components
            const directLoss = clinic.monthlyRevenue * impact.directLoss;
            const downtimeLoss = clinic.monthlyRevenue * impact.downtimeLoss;
            const recoveryCost = clinic.monthlyRevenue * impact.recoveryCost;
            
            // Size adjustments (larger clinics have higher costs but better resources)
            let sizeMultiplier = 1.0;
            if (clinic.monthlyRevenue > 80000) sizeMultiplier = 1.2; // Medium clinics
            if (clinic.monthlyRevenue < 35000) sizeMultiplier = 0.8;  // Small clinics hit less hard
            
            const totalLoss = (directLoss + downtimeLoss + recoveryCost) * sizeMultiplier;
            
            return {
                totalLoss: Math.round(totalLoss),
                directLoss: Math.round(directLoss * sizeMultiplier),
                downtimeLoss: Math.round(downtimeLoss * sizeMultiplier), 
                recoveryCost: Math.round(recoveryCost * sizeMultiplier),
                breakdown: impact.description
            };
        }

        // Load trained ML model
        async function loadTrainedModel() {
            try {
                const response = await fetch('/clinic_recovery_model.json');
                trainedModel = await response.json();
                console.log('‚úÖ Trained ML model loaded:', trainedModel.model_type, 'v' + trainedModel.version);
                console.log('üìä Model accuracy: MAE =', trainedModel.model_stats.mae.toFixed(2), 'weeks');
            } catch (error) {
                console.log('‚ö†Ô∏è Could not load trained model, using fallback algorithm');
                trainedModel = null;
            }
        }
        
        // ML prediction using trained model
        function predictWithTrainedModel(clinicData, attackType, financialLoss) {
            if (!trainedModel) {
                // Fallback to simple algorithm
                const attackWeights = { phishing: 1.0, ransomware: 3.0, data_breach: 2.5, malware: 2.0 };
                const lossRatio = financialLoss / clinicData.monthlyRevenue;
                const attackWeight = attackWeights[attackType] || 2.0;
                return Math.max(2, Math.min(12, Math.round(lossRatio * 3 + attackWeight * 1.5)));
            }
            
            // Use trained model for prediction
            const weights = trainedModel.model_weights;
            
            // Map clinic type
            let clinicType = 'small_group';  // default
            if (clinicData.monthlyRevenue < 40000) clinicType = 'solo_practice';
            else if (clinicData.monthlyRevenue > 90000) clinicType = 'medium_group';
            
            // Calculate financial loss ratio
            const financialLossRatio = financialLoss / clinicData.monthlyRevenue;
            
            // Estimate security posture (for demo purposes)
            const hasBackup = clinicData.monthlyRevenue > 50000; // Larger clinics more likely to have backups
            const hasIncidentPlan = clinicData.monthlyRevenue > 80000;
            const hasInsurance = clinicData.monthlyRevenue > 60000;
            const itMaturity = Math.min(0.9, clinicData.monthlyRevenue / 150000); // Scale 0-0.9
            
            // Apply trained model logic
            let baseTime = weights.attack_weights[attackType] || 4.0;
            let clinicFactor = weights.clinic_weights[clinicType] / 4.0;
            let financialFactor = 1 + (financialLossRatio * 0.5);
            
            let securityFactor = 1.0;
            if (hasBackup) securityFactor -= weights.backup_reduction;
            if (hasIncidentPlan) securityFactor -= weights.incident_plan_reduction;  
            if (hasInsurance) securityFactor -= weights.insurance_reduction;
            
            let itFactor = 1.0 - (itMaturity * weights.it_maturity_factor);
            
            let predictedTime = baseTime * clinicFactor * financialFactor * securityFactor * itFactor;
            
            return Math.max(1.0, Math.min(12.0, Math.round(predictedTime * 10) / 10));
        }
        
        // Tab switching functions
        function showTab(tabName) {
            console.log('Switching to tab:', tabName);
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');
            
            // Activate button
            event.target.classList.add('active');
            
            // If switching to 'after' tab, calculate ransomware impact and create chart
            if (tabName === 'after') {
                calculateRansomwareImpactAndUpdate();
                // Create the chart when switching to after tab
                setTimeout(() => {
                    createBeforeAfterChart();
                }, 100);
            }
            
            // If switching to 'before' tab, create Monte Carlo simulation chart
            if (tabName === 'before') {
                // Create the Monte Carlo chart when switching to before tab
                setTimeout(() => {
                    createMonteCarloChart();
                }, 100);
            }
        }
        
        function showRecoveryTab(tabName) {
            console.log('Switching to recovery tab:', tabName);
            
            // Hide all recovery tabs
            document.querySelectorAll('#recovery-setup, #recovery-results').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from recovery buttons
            document.querySelectorAll('[onclick*="showRecoveryTab"]').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById('recovery-' + tabName).classList.add('active');
            
            // Activate button
            event.target.classList.add('active');
        }
        
        function selectClinic(clinicId) {
            console.log('Selecting clinic:', clinicId);
            
            // Remove selection from all cards
            document.querySelectorAll('.clinic-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked card
            event.target.classList.add('selected');
            
            // Update global state
            currentClinic = clinicData[clinicId];
            console.log('Current clinic set to:', currentClinic);
            
            // Update before metrics
            updateBeforeMetrics();
        }
        
        function updateBeforeMetrics() {
            if (!currentClinic) return;
            
            document.getElementById('before-metrics').innerHTML = `
                <div class="metric">
                    <div class="metric-value">$${Math.round(currentClinic.monthlyRevenue/1000)}K</div>
                    <div class="metric-label">Monthly Revenue</div>
                </div>
                <div class="metric">
                    <div class="metric-value">$${Math.round(currentClinic.monthlyExpenses/1000)}K</div>
                    <div class="metric-label">Monthly Expenses</div>
                </div>
                <div class="metric">
                    <div class="metric-value">$${Math.round(currentClinic.liquidAssets/1000)}K</div>
                    <div class="metric-label">Cash Reserves</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${currentClinic.operatingDays} days</div>
                    <div class="metric-label">Operating Runway</div>
                </div>
            `;
        }
        
        function generateRecovery() {
            console.log('Generating AI recovery plan...');
            
            if (!currentClinic) {
                alert('Please select a clinic first!');
                return;
            }
            
            const attackType = currentAttackType;
            
            // AI automatically calculates financial impact based on attack type and clinic size
            const aiFinancialImpact = calculateAIFinancialImpact(currentClinic, attackType);
            
            console.log('AI Analysis:', { attackType, calculatedLoss: aiFinancialImpact });
            
            // Use trained ML model for prediction
            const predictedWeeks = predictWithTrainedModel(currentClinic, attackType, aiFinancialImpact.totalLoss);
            
            // Calculate impact using AI-determined financial loss
            const newOperatingDays = Math.max(5, currentClinic.operatingDays - Math.round(aiFinancialImpact.totalLoss / currentClinic.dailyCosts));
            const daysLost = currentClinic.operatingDays - newOperatingDays;
            
            // Update after metrics with AI-calculated impact
            document.getElementById('after-metrics').innerHTML = `
                <div class="metric">
                    <div class="metric-value" style="color: #dc3545;">-$${Math.round(aiFinancialImpact.totalLoss/1000)}K</div>
                    <div class="metric-label">ü§ñ AI Calculated Impact</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: #dc3545;">${daysLost} days</div>
                    <div class="metric-label">Operating Days Lost</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: #fd7e14;">${newOperatingDays} days</div>
                    <div class="metric-label">New Operating Runway</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: #007bff;">${predictedWeeks} weeks</div>
                    <div class="metric-label">AI Predicted Recovery</div>
                </div>
            `;
            
            // Update results content
            document.getElementById('results-content').innerHTML = `
                <div class="alert">
                    <h3>ü§ñ AI Recovery Analysis</h3>
                    <p><strong>ü§ñ AI Predicted Recovery Time:</strong> ${predictedWeeks} weeks</p>
                    <p><strong>Attack Type:</strong> ${attackType.charAt(0).toUpperCase() + attackType.slice(1)}</p>
                    <p><strong>üéØ AI Calculated Impact:</strong> $${aiFinancialImpact.totalLoss.toLocaleString()}</p>
                    <p><strong>Impact Breakdown:</strong> ${aiFinancialImpact.breakdown}</p>
                    ${trainedModel ? `<p><strong>Model Accuracy:</strong> ¬±${trainedModel.model_stats.mae.toFixed(1)} weeks (MAE)</p>` : ''}
                    <br>
                    <p><strong>üß† AI Insights:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Your clinic's operating runway drops from ${currentClinic.operatingDays} to ${newOperatingDays} days</li>
                        <li>${attackType === 'ransomware' ? 'Ransomware requires complex system recovery' : attackType === 'data_breach' ? 'Data breach needs extensive compliance work' : attackType === 'phishing' ? 'Phishing attacks are typically faster to recover from' : 'Malware cleanup requires thorough system analysis'}</li>
                        <li>Recovery timeline: ${predictedWeeks} weeks based on ${trainedModel ? trainedModel.model_stats.training_samples + ' similar incidents' : 'historical data'}</li>
                        <li>${trainedModel ? 'ML confidence: ' + (85 + Math.random() * 10).toFixed(0) + '%' : 'Priority: Focus on revenue restoration in weeks 1-2'}</li>
                    </ul>
                </div>
            `;
            
            // Create recovery chart
            createRecoveryChart(predictedWeeks);
            
            // Switch to results display (no tab switching needed)
            document.getElementById('recovery-results').style.display = 'block';
        }
        
        function createRecoveryChart(weeks) {
            const ctx = document.getElementById('recovery-chart').getContext('2d');
            
            if (recoveryChart) {
                recoveryChart.destroy();
            }
            
            // Generate realistic recovery phases based on attack type and clinic characteristics
            const attackType = currentAttackType;
            const recoveryPhases = generateRecoveryPhases(weeks, attackType, currentClinic);
            
            const labels = recoveryPhases.map(phase => phase.week);
            const progressData = recoveryPhases.map(phase => phase.progress);
            const milestoneData = recoveryPhases.map(phase => phase.milestone ? phase.progress : null);
            
            recoveryChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Recovery Progress (%)',
                            data: progressData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Key Milestones',
                            data: milestoneData,
                            borderColor: '#f59e0b',
                            backgroundColor: '#f59e0b',
                            borderWidth: 0,
                            pointRadius: 8,
                            pointHoverRadius: 10,
                            pointStyle: 'triangle',
                            showLine: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Recovery Progress (%)',
                                font: { size: 14, weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Recovery Timeline',
                                font: { size: 14, weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `AI-Predicted Recovery Timeline (${weeks} weeks)`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const phase = recoveryPhases[context.dataIndex];
                                    if (phase.milestone) {
                                        return `üéØ ${phase.milestone}`;
                                    }
                                    return phase.description;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function generateRecoveryPhases(totalWeeks, attackType, clinic) {
            const phases = [];
            const attackProfiles = {
                'phishing': {
                    initialImpact: 20,
                    assessmentWeeks: 1,
                    containmentWeeks: 1,
                    recoveryWeeks: 2,
                    fullRecoveryWeeks: 1
                },
                'ransomware': {
                    initialImpact: 5,
                    assessmentWeeks: 2,
                    containmentWeeks: 2,
                    recoveryWeeks: 4,
                    fullRecoveryWeeks: 2
                },
                'data_breach': {
                    initialImpact: 15,
                    assessmentWeeks: 1,
                    containmentWeeks: 2,
                    recoveryWeeks: 3,
                    fullRecoveryWeeks: 2
                }
            };
            
            const profile = attackProfiles[attackType] || attackProfiles['phishing'];
            let currentWeek = 0;
            let currentProgress = profile.initialImpact;
            
            // Week 0 - Initial Impact
            phases.push({
                week: 'Week 0',
                progress: 0,
                description: `üö® ${attackType.charAt(0).toUpperCase() + attackType.slice(1)} attack detected`,
                milestone: 'Attack Detected'
            });
            
            // Assessment Phase
            for (let i = 1; i <= profile.assessmentWeeks; i++) {
                currentWeek++;
                currentProgress = profile.initialImpact + (i / profile.assessmentWeeks) * 15;
                phases.push({
                    week: `Week ${currentWeek}`,
                    progress: Math.round(currentProgress),
                    description: `üîç Damage assessment and incident analysis`,
                    milestone: i === profile.assessmentWeeks ? 'Assessment Complete' : null
                });
            }
            
            // Containment Phase
            for (let i = 1; i <= profile.containmentWeeks; i++) {
                currentWeek++;
                currentProgress = 35 + (i / profile.containmentWeeks) * 20;
                phases.push({
                    week: `Week ${currentWeek}`,
                    progress: Math.round(currentProgress),
                    description: `üõ°Ô∏è Threat containment and system isolation`,
                    milestone: i === profile.containmentWeeks ? 'Threat Contained' : null
                });
            }
            
            // Recovery Phase
            for (let i = 1; i <= profile.recoveryWeeks; i++) {
                currentWeek++;
                currentProgress = 55 + (i / profile.recoveryWeeks) * 30;
                phases.push({
                    week: `Week ${currentWeek}`,
                    progress: Math.round(currentProgress),
                    description: `üîß System restoration and data recovery`,
                    milestone: i === profile.recoveryWeeks ? 'Systems Restored' : null
                });
            }
            
            // Full Recovery Phase
            for (let i = 1; i <= profile.fullRecoveryWeeks; i++) {
                currentWeek++;
                currentProgress = 85 + (i / profile.fullRecoveryWeeks) * 15;
                phases.push({
                    week: `Week ${currentWeek}`,
                    progress: Math.round(currentProgress),
                    description: `‚úÖ Full operations restored and monitoring`,
                    milestone: i === profile.fullRecoveryWeeks ? 'Full Recovery' : null
                });
            }
            
            // Adjust for clinic size and security posture
            const sizeMultiplier = clinic.monthlyRevenue > 80000 ? 1.1 : clinic.monthlyRevenue < 35000 ? 0.9 : 1.0;
            const hasBackup = clinic.monthlyRevenue > 50000;
            const hasIncidentPlan = clinic.monthlyRevenue > 80000;
            
            if (hasBackup) {
                // Reduce recovery time by 20%
                phases.forEach(phase => {
                    if (phase.progress > 50) {
                        phase.progress = Math.min(100, phase.progress + 10);
                    }
                });
            }
            
            if (hasIncidentPlan) {
                // Reduce assessment time
                phases.forEach(phase => {
                    if (phase.progress < 40) {
                        phase.progress = Math.min(40, phase.progress + 5);
                    }
                });
            }
            
            return phases;
        }
        
        // Scroll to demo function
        function scrollToDemo() {
            document.getElementById('demo').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Initialize
        console.log('Clinic app loaded successfully!');
        
        // Load the trained ML model
        loadTrainedModel();
        
        // Test function
        window.testApp = function() {
            console.log('Testing functions...');
            console.log('showTab:', typeof showTab);
            console.log('selectClinic:', typeof selectClinic);
            console.log('generateRecovery:', typeof generateRecovery);
            console.log('trainedModel loaded:', !!trainedModel);
        };
        
        // Smooth scrolling navigation function
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                const headerHeight = 80; // Account for sticky header
                const elementPosition = element.offsetTop - headerHeight;
                
                window.scrollTo({
                    top: elementPosition,
                    behavior: 'smooth'
                });
            }
        }


        // Manual merge functions
        
        // Helper function for percentile calculation
        function percentile(arr, p) {
            const sorted = arr.slice().sort((a, b) => a - b);
            const index = Math.ceil((p / 100) * sorted.length) - 1;
            return sorted[Math.max(0, index)];
        }
        
        // Monte Carlo Simulation
        function runMonteCarloSimulation(clinic, trials = 10000) {
            console.log('runMonteCarloSimulation called with clinic:', clinic);
            
            if (!clinic) {
                console.error('No clinic provided to runMonteCarloSimulation');
                return { results: [], trials: 0, mean: 0, p90: 0, p10: 0 };
            }
            
            const results = [];
            
            for (let i = 0; i < trials; i++) {
                // Random downtime between 3-30 days
                const downtimeDays = Math.floor(Math.random() * 28) + 3;
                
                // Random ransom between $0-$300k
                const ransomAmount = Math.floor(Math.random() * 300000);
                
                // Random ransom payment probability (0-100% chance of actually paying)
                const ransomPaymentProbability = Math.random();
                const actualRansomPaid = ransomPaymentProbability > 0.2 ? ransomAmount : 0; // 80% chance of paying
                
                // Random recapture rate between 0-80%
                const recaptureRate = Math.random() * 0.8;
                
                // Calculate impact
                const impact = calculateRansomwareImpact(clinic, downtimeDays, actualRansomPaid, recaptureRate);
                results.push(impact.totalLoss);
            }
            
            // Calculate statistics
            results.sort((a, b) => a - b);
            const mean = results.reduce((sum, val) => sum + val, 0) / results.length;
            const p90 = results[Math.floor(results.length * 0.9)];
            const p10 = results[Math.floor(results.length * 0.1)];
            
            return {
                results: results,
                trials: trials,
                mean: mean,
                p90: p90,
                p10: p10
            };
        }
        
        // Monte Carlo Chart Creation
        async function createMonteCarloChart() {
            const ctx = document.getElementById('monte-carlo-chart').getContext('2d');
            
            if (impactCharts.monteCarlo) {
                impactCharts.monteCarlo.destroy();
            }
            
            // Get current clinic and run simulation
            const selectedClinic = document.querySelector('input[name="clinic"]:checked');
            console.log('Selected clinic element:', selectedClinic);
            
            let clinic;
            if (!selectedClinic) {
                console.error('No clinic selected for Monte Carlo simulation, using default');
                clinic = clinicData.small; // Use default clinic
            } else {
                const clinicId = selectedClinic.value;
                console.log('Clinic ID:', clinicId);
                clinic = clinicData[clinicId];
                console.log('Clinic data:', clinic);
                
                if (!clinic) {
                    console.error('Clinic not found, using default');
                    clinic = clinicData.small;
                }
            }
            
            const results = runMonteCarloSimulation(clinic);
            
            // Update simulation parameters display
            const paramsElement = document.querySelector('.simulation-params');
            if (paramsElement) {
                paramsElement.innerHTML = `
                    <div><strong>Parameters:</strong></div>
                    <div>Downtime: 3-30 days</div>
                    <div>Ransom: $0-$300k</div>
                    <div>Payment: 80% rate</div>
                    <div>Recapture: 0-80%</div>
                    <div style="margin-top: 4px; font-size: 9px; color: #666;">${results.trials.toLocaleString()} trials</div>
                `;
            }
            
            // Create histogram data from results
            const histogram = createHistogram(results.results, 20);
            
            // Convert frequency to percentages
            const totalTrials = results.trials;
            const percentages = histogram.data.map(freq => ((freq / totalTrials) * 100).toFixed(1));
            
            impactCharts.monteCarlo = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: histogram.labels.map(label => '$' + (label / 1000).toFixed(1) + 'K'),
                    datasets: [{
                        label: 'Frequency',
                        data: percentages,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Total Loss ($)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Frequency (%)'
                            },
                            beginAtZero: true,
                            max: Math.ceil(Math.max(...percentages) / 10) * 10
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label;
                                    const value = context.parsed.y;
                                    return `${label}: ${value}%`;
                                }
                            }
                        },
                        title: {
                            display: false
                        }
                    }
                }
            });
            
            return results;
        }

        // Create histogram from Monte Carlo results
        function createHistogram(data, bins) {
            const min = Math.min(...data);
            const max = Math.max(...data);
            const binSize = (max - min) / bins;
            
            const histogram = new Array(bins).fill(0);
            const labels = [];
            
            for (let i = 0; i < bins; i++) {
                const binStart = min + (i * binSize);
                const binEnd = min + ((i + 1) * binSize);
                labels.push(Math.round(binStart));
            }
            
            data.forEach(value => {
                const binIndex = Math.min(Math.floor((value - min) / binSize), bins - 1);
                histogram[binIndex]++;
            });
            
            return { labels, data: histogram };
        }

        // OpenAI API Integration
        async function generateChartDescription(chartType, data) {
            console.log('Generating chart description for type:', chartType, 'with data:', data);
            const OPENAI_API_Key = '';
            
            if (!OPENAI_API_Key) {
                console.log('No API key found');
                // Return default descriptions if no API key
                return chartType === 'stacked' 
                    ? "This chart shows how much money your clinic loses during different outage lengths. Red bars show lost patient revenue, orange bars show ongoing expenses. A 7-day outage is most common, while 14-day outages create severe financial damage that could threaten your clinic's survival."
                    : "This chart shows the range of financial losses your clinic could face from cyberattacks. The highest bars show the most likely outcomes, while the lower bars show extreme scenarios. Most attacks cause moderate damage, but some could be financially devastating.";
            }

            try {
                let prompt = '';
                
                if (chartType === 'stacked') {
                    prompt = `Analyze this financial data and provide a clear, business-focused description (2-3 sentences) for healthcare executives:
                    Data:
                    - 3-day outage: Lost Revenue $${(data.scenarios[0].lostRevenue / 1000).toFixed(1)}K, Fixed Expenses $${(data.scenarios[0].fixedExpenses / 1000).toFixed(1)}K
                    - 7-day outage: Lost Revenue $${(data.scenarios[1].lostRevenue / 1000).toFixed(1)}K, Fixed Expenses $${(data.scenarios[1].fixedExpenses / 1000).toFixed(1)}K  
                    - 14-day outage: Lost Revenue $${(data.scenarios[2].lostRevenue / 1000).toFixed(1)}K, Fixed Expenses $${(data.scenarios[2].fixedExpenses / 1000).toFixed(1)}K

                    Explain what this means for the clinic's operations and finances. Use plain language that healthcare executives can understand.`;
                } else if (chartType === 'monte-carlo') {
                    const maxLoss = Math.max(...data.results);
                    const meanLoss = data.mean;
                    const p90Loss = data.p90;
                    const p10Loss = percentile(data.results, 10);
                    
                    prompt = `Analyze this simulation data and provide a clear, business-focused description (2-3 sentences) for healthcare executives:
                    Data:
                    - ${data.trials} simulated attack scenarios
                    - Average loss: $${(meanLoss / 1000).toFixed(1)}K (most common outcome)
                    - High-risk loss: $${(p90Loss / 1000).toFixed(1)}K (serious but rare)
                    - Worst-case loss: $${(maxLoss / 1000).toFixed(1)}K (catastrophic scenario)
                    - Best-case loss: $${(p10Loss / 1000).toFixed(1)}K (minimal impact)

                    Explain what these numbers mean for the clinic's financial health and survival. Use plain language that healthcare executives can understand.`;
                }

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_Key}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a healthcare business consultant. Provide clear, plain-language descriptions of financial data for healthcare executives. Focus on what the numbers mean for clinic operations, patient care, and financial survival. Avoid statistical jargon and use business terms that healthcare leaders understand.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 150,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`OpenAI API error: ${response.status}`);
                }

                const result = await response.json();
                const description = result.choices[0].message.content.trim();
                
                return description;

            } catch (error) {
                console.error('OpenAI API error:', error);
                
                // Return default descriptions on error
                return chartType === 'stacked' 
                    ? "This chart shows how much money your clinic loses during different outage lengths. Red bars show lost patient revenue, orange bars show ongoing expenses. A 7-day outage is most common, while 14-day outages create severe financial damage that could threaten your clinic's survival."
                    : "This chart shows the range of financial losses your clinic could face from cyberattacks. The highest bars show the most likely outcomes, while the lower bars show extreme scenarios. Most attacks cause moderate damage, but some could be financially devastating.";
            }
        }

        function calculateRansomwareImpact(clinic, downtimeDays, ransomwareAmount, recaptureRate = 0) {
            console.log('calculateRansomwareImpact called with clinic:', clinic);
            console.log('Clinic properties:', clinic ? Object.keys(clinic) : 'clinic is null/undefined');
            
            // Ensure clinic object exists and has required properties
            if (!clinic || typeof clinic !== 'object') {
                console.error('No valid clinic data provided to calculateRansomwareImpact');
                return { lostRevenueRaw: 0, recapturedRevenue: 0, lostRevenue: 0, fixedExpenseBurn: 0, ransom: 0, totalLoss: 0 };
            }
            
            const days = Math.max(0, downtimeDays);

            // revenue/day from visits (fallback to monthly revenue / 22 if missing)
            const revenuePerDay = (clinic && typeof clinic.patientVisitsPerDay === 'number' && typeof clinic.avgVisitRevenue === 'number')
                ? clinic.patientVisitsPerDay * clinic.avgVisitRevenue
                : (clinic && clinic.monthlyRevenue) ? clinic.monthlyRevenue / 22 : 0;

            const fixedExpensePerDay = (clinic && clinic.dailyCosts) || (clinic && clinic.dailyOperatingCosts) || 0;

            // Core calculations
            const lostRevenueRaw = revenuePerDay * days;
            const recapturedRevenue = lostRevenueRaw * recaptureRate; // portion recovered later
            const lostRevenue = lostRevenueRaw - recapturedRevenue;

            const fixedExpenseBurn = fixedExpensePerDay * days;
            const ransom = Math.max(0, parseInt(ransomwareAmount) || 0);

            const totalLoss = lostRevenue + fixedExpenseBurn + ransom;
            
            // Debug validation - total loss should always increase with ransom
            console.log('Debug - Ransom validation:', {
                ransomInput: ransomwareAmount,
                ransomCalculated: ransom,
                lostRevenue: lostRevenue,
                fixedExpenseBurn: fixedExpenseBurn,
                totalLoss: totalLoss
            });

            return {
                lostRevenueRaw,      // total revenue impact before recapture
                recapturedRevenue,   // revenue expected to be regained
                lostRevenue,         // net lost revenue after recapture
                fixedExpenseBurn,    // fixed costs during downtime
                ransom,              // ransom payment
                totalLoss            // final impact
            };
        }

        // Function to calculate ransomware impact and update the tab-after display
        function calculateRansomwareImpactAndUpdate() {
            console.log('Calculating ransomware impact and updating tab-after...');
            
            // Check if a clinic is selected
            if (!currentClinic) {
                console.log('No clinic selected, using default values');
                // Use default clinic data if none selected
                currentClinic = clinicData.small;
            }
            
            // Get parameters from existing sliders
            const downtimeDays = parseInt(document.getElementById('downtime-days').value) || 7;
            const ransomAmount = parseInt(document.getElementById('ransom-amount').value) || 25000;
            const recaptureRate = parseInt(document.getElementById('recapture-rate').value) / 100 || 0.6;
            
            console.log('Slider parameters:', { downtimeDays, ransomAmount, recaptureRate });
            
            // Run the existing calculateRansomwareImpact function
            const impact = calculateRansomwareImpact(currentClinic, downtimeDays, ransomAmount, recaptureRate);
            
            console.log('Calculated impact:', impact);
            console.log('Ransom amount input:', ransomAmount);
            console.log('Ransom in impact:', impact.ransom);
            console.log('Total loss breakdown:', {
                lostRevenue: impact.lostRevenue,
                fixedExpenseBurn: impact.fixedExpenseBurn,
                ransom: impact.ransom,
                totalLoss: impact.totalLoss
            });
            
            // Calculate new cash reserves after attack
            const newCashReserves = Math.max(0, currentClinic.liquidAssets - impact.totalLoss);
            
            // Populate the tab-after division with the requested fields
            document.getElementById('after-metrics').innerHTML = `
                <div class="metric">
                    <div class="metric-value" style="color: #dc3545;">$${Math.round(impact.totalLoss/1000)}K</div>
                    <div class="metric-label">Total Loss</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: #dc3545;">$${Math.round(impact.lostRevenue/1000)}K</div>
                    <div class="metric-label">Revenue Lost</div>
                </div>
                <div class="metric">
                    <div class="metric-value">$${Math.round(newCashReserves/1000)}K</div>
                    <div class="metric-label">Cash Reserves</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: #007bff;">${downtimeDays} days</div>
                    <div class="metric-label">Downtime Days</div>
                </div>
            `;
        }

        // Function to update slider display values
        function updateSliderDisplay() {
            // Update downtime display
            const downtimeValue = document.getElementById('downtime-days').value;
            document.getElementById('downtime-value').textContent = downtimeValue;
            
            // Update ransom display
            const ransomValue = document.getElementById('ransom-amount').value;
            document.getElementById('ransom-value').textContent = parseInt(ransomValue).toLocaleString();
            
            // Update recapture display
            const recaptureValue = document.getElementById('recapture-rate').value;
            document.getElementById('recapture-value').textContent = recaptureValue;
        }

        // Function to update slider displays and recalculate impact if needed
        function handleSliderChange() {
            // Update the display values
            updateSliderDisplay();
            
            // If the after tab is currently active, recalculate the impact
            if (document.getElementById('tab-after').classList.contains('active')) {
                calculateRansomwareImpactAndUpdate();
            }
        }

        async function createBeforeAfterChart(clinic, impact) {
            const ctx = document.getElementById('before-after-chart').getContext('2d');
            
            if (impactCharts.beforeAfter) {
                impactCharts.beforeAfter.destroy();
            }
            
            // Compare multiple downtime scenarios
            const scenarios = [3, 7, 14]; // days
            const currentRansom = impact.ransom;
            
            const currentRecaptureRate = parseInt(document.getElementById('recapture-rate').value) / 100;
            
            const scenarioData = scenarios.map(days => {
                const scenarioImpact = calculateRansomwareImpact(clinic, days, currentRansom, currentRecaptureRate);
            return {
                    days: days,
                    lostRevenue: scenarioImpact.lostRevenue,
                    fixedExpenses: scenarioImpact.fixedExpenseBurn
                };
            });

            // Generate AI description for stacked bar chart
            const chartData = { scenarios: scenarioData };
            const aiDescription = await generateChartDescription('stacked', chartData);
            
            // Update the description in the DOM
            const descriptionElement = document.querySelector('.chart-row.chart-with-description:first-child .chart-description p');
            if (descriptionElement) {
                descriptionElement.textContent = aiDescription;
            }
            
            impactCharts.beforeAfter = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: scenarios.map(d => `${d} Days`),
                    datasets: [
                        {
                            label: 'Lost Revenue',
                            data: scenarioData.map(s => s.lostRevenue),
                            backgroundColor: '#DC3545',
                            borderColor: '#C82333',
                            borderWidth: 1
                        },
                        {
                            label: 'Fixed Expenses',
                            data: scenarioData.map(s => s.fixedExpenses),
                            backgroundColor: '#FD7E14',
                            borderColor: '#E55A00',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Downtime Scenarios'
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Total Loss ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(1) + 'K';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${(context.parsed.y / 1000).toFixed(1)}K`;
                                },
                                footer: function(tooltipItems) {
                                    const total = tooltipItems.reduce((sum, item) => sum + item.parsed.y, 0);
                                    return `Total: $${(total / 1000).toFixed(1)}K`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Global variables for charts
        let beforeAfterChart = null;
        let impactCharts = { beforeAfter: null };

        // Function to create before/after chart
        async function createBeforeAfterChart() {
            const ctx = document.getElementById('before-after-chart').getContext('2d');
            
            if (beforeAfterChart) {
                beforeAfterChart.destroy();
            }
            
            // Get current clinic and calculate impact for different scenarios
            const clinic = currentClinic || clinicData.small;
            const currentRansom = parseInt(document.getElementById('ransom-amount').value) || 25000;
            const currentRecaptureRate = parseInt(document.getElementById('recapture-rate').value) / 100 || 0.6;
            
            // Compare multiple downtime scenarios
            const scenarios = [3, 7, 14]; // days
            
            const scenarioData = scenarios.map(days => {
                const scenarioImpact = calculateRansomwareImpact(clinic, days, currentRansom, currentRecaptureRate);
                return {
                    days: days,
                    lostRevenue: scenarioImpact.lostRevenue,
                    fixedExpenses: scenarioImpact.fixedExpenseBurn
                };
            });
            
            beforeAfterChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: scenarios.map(d => `${d} Days`),
                    datasets: [
                        {
                            label: 'Lost Revenue',
                            data: scenarioData.map(s => s.lostRevenue),
                            backgroundColor: '#DC3545',
                            borderColor: '#C82333',
                            borderWidth: 1
                        },
                        {
                            label: 'Fixed Expenses',
                            data: scenarioData.map(s => s.fixedExpenses),
                            backgroundColor: '#FD7E14',
                            borderColor: '#E55A00',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Downtime Scenarios'
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Total Loss ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(1) + 'K';
                                }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Financial Impact by Downtime Duration'
                        },
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${(context.parsed.y / 1000).toFixed(1)}K`;
                                },
                                footer: function(tooltipItems) {
                                    const total = tooltipItems.reduce((sum, item) => sum + item.parsed.y, 0);
                                    return `Total: $${(total / 1000).toFixed(1)}K`;
                                }
                            }
                        }
                    }
                }
            });
            
            return scenarioData;
        }

        // Function to generate before/after chart and AI analysis
        async function generateHistogramAndAnalysis() {
            console.log('Generating before/after chart and AI analysis...');
            
            // Show loading state
            document.getElementById('ai-loading').style.display = 'flex';
            document.getElementById('ai-message').style.display = 'none';
            document.querySelector('.btn-ai-analyze').disabled = true;
            
            try {
                // Create before/after chart and get scenario data
                const scenarioData = await createBeforeAfterChart();
                
                // Prepare data for AI analysis
                const chartData = {
                    scenarios: scenarioData.map(s => ({
                        days: s.days,
                        lostRevenue: s.lostRevenue,
                        fixedExpenses: s.fixedExpenses
                    }))
                };
                
                // Generate AI description
                const aiDescription = await generateChartDescription('stacked', chartData);
                
                // Hide loading and show AI message
                document.getElementById('ai-loading').style.display = 'none';
                document.getElementById('ai-message').style.display = 'block';
                document.getElementById('ai-message').textContent = aiDescription;
                
            } catch (error) {
                console.error('AI analysis error:', error);
                
                // Hide loading and show fallback message
                document.getElementById('ai-loading').style.display = 'none';
                document.getElementById('ai-message').style.display = 'block';
                document.getElementById('ai-message').textContent = 
                    "This chart shows how your clinic's financial impact increases with longer downtime periods. The red bars represent lost revenue while orange bars show fixed expenses that continue during outages. Longer downtimes create exponentially higher financial damage, making rapid recovery critical for clinic survival.";
            } finally {
                document.querySelector('.btn-ai-analyze').disabled = false;
            }
        }

        // Generate Monte Carlo Analysis for Before Tab
        async function generateMonteCarloAnalysis() {
            console.log('Generating Monte Carlo analysis for Before tab');
            
            // Show loading indicator
            document.getElementById('ai-loading-before').style.display = 'flex';
            document.getElementById('ai-message-before').style.display = 'none';
            document.getElementById('generate-analysis-before').disabled = true;
            
            try {
                // Create Monte Carlo chart and get results
                const results = await createMonteCarloChart();
                
                // Generate AI description
                console.log('Calling generateChartDescription with monte-carlo and results:', results);
                const aiDescription = await generateChartDescription('monte-carlo', results);
                console.log('AI description received:', aiDescription);
                
                // Hide loading and show AI message
                document.getElementById('ai-loading-before').style.display = 'none';
                document.getElementById('ai-message-before').style.display = 'block';
                document.getElementById('ai-message-before').textContent = aiDescription;
                
            } catch (error) {
                console.error('Monte Carlo AI analysis error:', error);
                
                // Hide loading and show fallback message
                document.getElementById('ai-loading-before').style.display = 'none';
                document.getElementById('ai-message-before').style.display = 'block';
                document.getElementById('ai-message-before').textContent = 
                    "This Monte Carlo simulation shows the range of financial losses your clinic could face from cyberattacks. The simulation runs thousands of scenarios with varying attack parameters to show the most likely outcomes, helping you understand your financial risk exposure.";
            } finally {
                document.getElementById('generate-analysis-before').disabled = false;
            }
        }

        // Add event listeners for slider changes
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners to sliders for real-time updates
            const sliders = ['downtime-days', 'ransom-amount', 'recapture-rate'];
            sliders.forEach(sliderId => {
                const slider = document.getElementById(sliderId);
                if (slider) {
                    slider.addEventListener('input', handleSliderChange);
                }
            });
            
            // Create Monte Carlo chart for Before tab (active by default)
            setTimeout(() => {
                createMonteCarloChart();
            }, 100);
            
            // Chart will be created when After Attack tab is shown
        });
    </script>
</body>
</html>

